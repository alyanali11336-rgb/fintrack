<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartSpend Elite | Sovereign Edition</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand: #6366f1; --bg: #0f172a; --surface: #1e293b; --surface-sub: #334155;
            --text: #f8fafc; --text-dim: #94a3b8; --success: #10b981; --danger: #f43f5e;
            --border: rgba(255,255,255,0.08); --radius: 28px;
        }

        /* THEMES */
        [data-theme="emerald"] { --brand: #10b981; --bg: #061f17; --surface: #0b2e24; }
        [data-theme="royal"] { --brand: #f59e0b; --bg: #1c1917; --surface: #292524; }
        [data-theme="midnight"] { --brand: #38bdf8; --bg: #020617; --surface: #0f172a; }
        [data-theme="crimson"] { --brand: #ef4444; --bg: #1a0505; --surface: #2d0a0a; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        .screen { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 110px; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }

        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: none; flex-direction: column; padding: 40px 24px; text-align: center; justify-content: center; }
        .pin-dot { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--brand); margin: 8px; }
        .pin-dot.filled { background: var(--brand); transform: scale(1.2); }

        .hero { background: linear-gradient(135deg, var(--brand) 0%, #000 150%); padding: 35px 25px; border-radius: var(--radius); color: white; margin-bottom: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .action-hub { display: flex; gap: 12px; margin-bottom: 25px; }
        .action-btn { flex: 1; padding: 18px; border-radius: 20px; border: none; color: white; font-weight: 800; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        
        .tx-card { background: var(--surface); padding: 18px; border-radius: 20px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .icon-box { width: 45px; height: 45px; border-radius: 14px; background: var(--surface-sub); display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--brand); }

        nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-link { color: var(--text-dim); text-align: center; font-size: 11px; font-weight: 700; cursor: pointer; }
        .nav-link.active { color: var(--brand); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9000; align-items: flex-end; }
        .modal-content { background: var(--surface); width: 100%; padding: 30px 24px; border-radius: 35px 35px 0 0; border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
        
        input, select { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 15px; border: 1px solid var(--border); background: var(--surface-sub); color: white; outline: none; }
        
        .theme-swatch { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
        .theme-swatch.active { border-color: white; }

        .icon-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .icon-sel { padding: 12px; border-radius: 12px; background: var(--surface-sub); text-align: center; cursor: pointer; }
        .icon-sel.active { background: var(--brand); color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body data-theme="default">

    <div id="lock-screen" class="overlay">
        <i class="fas fa-user-lock fa-3x" style="color:var(--brand); margin-bottom:20px;"></i>
        <h2 id="lock-status">Prisoner Restricted</h2>
        <div style="display:flex; justify-content:center; margin: 30px 0;" id="lock-dots">
            <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
        </div>
        <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; max-width:280px; margin: 0 auto;" id="lock-pad"></div>
    </div>

    <div id="home" class="screen active">
        <div class="hero">
            <small style="opacity:0.7; font-weight:800; text-transform:uppercase;">Net Liquidity</small>
            <h1 id="total-bal" style="font-size:42px; margin:5px 0;">--</h1>
            <div id="budget-progress" style="height:6px; background:rgba(255,255,255,0.2); border-radius:10px; margin-top:15px; overflow:hidden;">
                <div id="budget-bar" style="height:100%; background:white; width: 0%;"></div>
            </div>
        </div>
        <div class="action-hub">
            <button class="action-btn" style="background:var(--success);" onclick="openEntry('income')"><i class="fas fa-arrow-down-long"></i>Revenue</button>
            <button class="action-btn" style="background:var(--danger);" onclick="openEntry('expense')"><i class="fas fa-arrow-up-long"></i>Expense</button>
        </div>
        <div id="tx-list"></div>
    </div>

    <div id="insights" class="screen">
        <h2 style="margin-bottom:25px;">Analytics</h2>
        <div style="background:var(--surface); padding:20px; border-radius:24px; margin-bottom: 20px;">
            <canvas id="mainChart"></canvas>
        </div>
        <div id="breakdown"></div>
    </div>

    <div id="settings" class="screen">
        <h2 style="margin-bottom:25px;">System Console</h2>
        
        <h4 style="margin-bottom:12px; opacity:0.6;">Visual Identity</h4>
        <div style="display:flex; gap:15px; margin-bottom:30px;">
            <div class="theme-swatch active" style="background:#6366f1;" onclick="setTheme('default', this)"></div>
            <div class="theme-swatch" style="background:#10b981;" onclick="setTheme('emerald', this)"></div>
            <div class="theme-swatch" style="background:#f59e0b;" onclick="setTheme('royal', this)"></div>
            <div class="theme-swatch" style="background:#38bdf8;" onclick="setTheme('midnight', this)"></div>
            <div class="theme-swatch" style="background:#ef4444;" onclick="setTheme('crimson', this)"></div>
        </div>

        <h4 style="margin-bottom:12px; opacity:0.6;">Category Management</h4>
        <div id="cat-manager" style="margin-bottom:20px;"></div>
        <div style="background:var(--surface); padding:15px; border-radius:20px; border:1px solid var(--border);">
            <input type="text" id="new-cat-name" placeholder="Category Name" style="margin-bottom:10px;">
            <p style="font-size:12px; margin-bottom:10px; opacity:0.5;">Select Icon:</p>
            <div class="icon-grid" id="icon-picker"></div>
            <button onclick="addCustomCat()" style="width:100%; padding:15px; border-radius:12px; border:none; background:var(--brand); color:white; font-weight:800;">Add Category</button>
        </div>

        <div style="margin-top:30px; background:var(--surface); border-radius:20px; overflow:hidden;">
            <div style="padding:18px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between;" onclick="resetVault()">
                <span style="color:var(--danger);">Factory Reset</span><i class="fas fa-trash"></i>
            </div>
        </div>
    </div>

    <div id="entry-modal" class="modal" onclick="if(event.target==this) closeEntry()">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-bottom:20px;">Transaction</h2>
            <input type="number" id="amt" placeholder="0.00">
            <input type="text" id="desc" placeholder="Merchant/Source">
            <select id="entry-cat"></select>
            <button class="action-btn" style="background:var(--brand); width:100%;" onclick="saveEntry()">Commit Entry</button>
        </div>
    </div>

    <nav>
        <div class="nav-link active" onclick="nav('home', this)"><i class="fas fa-wallet"></i>Vault</div>
        <div class="nav-link" onclick="nav('insights', this)"><i class="fas fa-chart-line"></i>Insights</div>
        <div class="nav-link" onclick="nav('settings', this)"><i class="fas fa-sliders"></i>System</div>
    </nav>

    <script>
        const ICONS = ['fa-shopping-cart', 'fa-utensils', 'fa-car', 'fa-heart-pulse', 'fa-briefcase', 'fa-house', 'fa-bolt', 'fa-gift', 'fa-plane', 'fa-graduation-cap'];
        let db = [], config = { theme: 'default', cur: '$', pin: '1234', cats: [{n:'Salary', i:'fa-briefcase'}, {n:'Food', i:'fa-utensils'}] }, selectedIcon = 'fa-shopping-cart', tempPin = '';

        window.onload = function() {
            const sDb = localStorage.getItem('sv_db'), sCfg = localStorage.getItem('sv_cfg');
            if(sDb) db = JSON.parse(sDb);
            if(sCfg) config = JSON.parse(sCfg);
            
            setTheme(config.theme);
            document.getElementById('lock-screen').style.display = 'flex';
            renderLockPad();
            renderIconPicker();
            renderSettingsCats();
            renderHome();
        };

        function renderLockPad() {
            const n = ['1','2','3','4','5','6','7','8','9','','0','<'];
            document.getElementById('lock-pad').innerHTML = n.map(x => `<div style="font-size:24px; padding:20px; text-align:center;" onclick="hPad('${x}')">${x === '<' ? 'â†' : x}</div>`).join('');
        }

        function hPad(v) {
            if(v === '') return;
            if(v === '<') tempPin = tempPin.slice(0,-1);
            else if(tempPin.length < 4) tempPin += v;
            
            const dots = document.querySelectorAll('#lock-dots .pin-dot');
            dots.forEach((d,i) => d.className = i < tempPin.length ? 'pin-dot filled' : 'pin-dot');

            if(tempPin.length === 4) {
                if(tempPin === config.pin) { document.getElementById('lock-screen').style.display = 'none'; tempPin = ''; }
                else { alert('Access Denied'); tempPin = ''; dots.forEach(d => d.className = 'pin-dot'); }
            }
        }

        function setTheme(t, el) {
            document.body.setAttribute('data-theme', t);
            config.theme = t; saveCfg();
            if(el) {
                document.querySelectorAll('.theme-swatch').forEach(s => s.classList.remove('active'));
                el.classList.add('active');
            }
        }

        function renderIconPicker() {
            document.getElementById('icon-picker').innerHTML = ICONS.map(i => `
                <div class="icon-sel ${i === selectedIcon ? 'active' : ''}" onclick="selectedIcon='${i}'; renderIconPicker()">
                    <i class="fas ${i}"></i>
                </div>`).join('');
        }

        function addCustomCat() {
            const name = document.getElementById('new-cat-name').value;
            if(name) {
                config.cats.push({n: name, i: selectedIcon});
                saveCfg(); renderSettingsCats();
                document.getElementById('new-cat-name').value = '';
            }
        }

        function renderSettingsCats() {
            document.getElementById('cat-manager').innerHTML = config.cats.map(c => `
                <div class="tx-card">
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div class="icon-box"><i class="fas ${c.i}"></i></div>
                        <b>${c.n}</b>
                    </div>
                    <i class="fas fa-circle-xmark" style="color:var(--danger)" onclick="remCat('${c.n}')"></i>
                </div>`).join('');
            document.getElementById('entry-cat').innerHTML = config.cats.map(c => `<option value="${c.n}">${c.n}</option>`).join('');
        }

        function remCat(n) { config.cats = config.cats.filter(c => c.n !== n); saveCfg(); renderSettingsCats(); }
        function saveCfg() { localStorage.setItem('sv_cfg', JSON.stringify(config)); }

        function openEntry(type) {
            document.getElementById('entry-modal').style.display = 'flex';
            window.currentType = type;
        }

        function saveEntry() {
            const amt = parseFloat(document.getElementById('amt').value);
            const desc = document.getElementById('desc').value || 'Transaction';
            const cat = document.getElementById('entry-cat').value;
            if(!amt) return;
            db.push({ type: window.currentType, amt, desc, cat, date: new Date().toLocaleDateString() });
            localStorage.setItem('sv_db', JSON.stringify(db));
            document.getElementById('entry-modal').style.display = 'none';
            renderHome();
        }

        function renderHome() {
            const list = document.getElementById('tx-list');
            list.innerHTML = ''; let bal = 0;
            db.slice().reverse().forEach(t => {
                const isInc = t.type === 'income';
                bal += (isInc ? t.amt : -t.amt);
                const icon = config.cats.find(c => c.n === t.cat)?.i || 'fa-receipt';
                list.innerHTML += `
                <div class="tx-card">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div class="icon-box"><i class="fas ${icon}"></i></div>
                        <div><b>${t.desc}</b><br><small style="opacity:0.5">${t.cat}</small></div>
                    </div>
                    <b style="color:${isInc ? 'var(--success)' : 'white'}">${isInc ? '+' : '-'}${config.cur}${t.amt}</b>
                </div>`;
            });
            document.getElementById('total-bal').innerText = `${config.cur}${bal.toLocaleString()}`;
        }

        function nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function resetVault() { if(confirm("Permanent data wipe?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
