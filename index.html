<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartSpend Titanium</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand: #6366f1; --bg: #05070a; --surface: #11141d; --surface-sub: #1c212e;
            --text: #ffffff; --text-dim: #94a3b8; --success: #10b981; --danger: #f43f5e;
            --border: rgba(255,255,255,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* App Screens */
        .screen { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 100px; }
        .active-screen { display: block !important; animation: appFade 0.3s ease; }

        /* UI Elements */
        .hero { background: linear-gradient(135deg, var(--brand) 0%, #000 150%); padding: 30px; border-radius: 24px; margin-bottom: 20px; text-align: center; }
        .tx-card { background: var(--surface); padding: 16px; border-radius: 16px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-action { background: var(--brand); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; width: 100%; }

        /* Lock & Overlays */
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
        .pin-dot { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--brand); margin: 8px; }
        .pin-dot.filled { background: var(--brand); }
        .n-pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; width: 100%; max-width: 300px; }
        .n-pad div { font-size: 24px; font-weight: 700; padding: 15px; text-align: center; cursor: pointer; }

        /* Nav */
        nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: #000; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); }
        .nav-btn { color: var(--text-dim); text-align: center; font-size: 10px; cursor: pointer; }
        .nav-btn.active { color: var(--brand); }
        .nav-btn i { font-size: 22px; display: block; margin-bottom: 4px; }

        .search-box { width: 100%; padding: 14px; border-radius: 12px; background: var(--surface); border: 1px solid var(--border); color: white; margin-bottom: 20px; }

        @keyframes appFade { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="lock-screen" class="overlay">
        <i class="fas fa-shield-halved fa-3x" style="color:var(--brand); margin-bottom:20px;"></i>
        <h2 style="letter-spacing:1px;">VAULT LOCKED</h2>
        <div style="display:flex; margin: 20px 0;" id="dots">
            <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
        </div>
        <div class="n-pad" id="pad"></div>
    </div>

    <div id="ob-screen" class="overlay" style="display:none;">
        <h2>Select Currency</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; width:100%; margin: 30px 0;" id="cur-list"></div>
    </div>

    <div id="scr-home" class="screen active-screen">
        <div class="hero">
            <small style="opacity:0.6; font-weight:800;">TOTAL ASSETS</small>
            <h1 id="main-bal" style="font-size:42px; margin:5px 0;">--</h1>
        </div>
        
        <input type="text" id="search" class="search-box" placeholder="Search entries..." oninput="updateHome()">

        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="btn-action" style="background:var(--success)" onclick="showModal('income')">Revenue</button>
            <button class="btn-action" style="background:var(--danger)" onclick="showModal('expense')">Expense</button>
        </div>
        <div id="history"></div>
    </div>

    <div id="scr-stats" class="screen">
        <h2 style="margin-bottom:20px;">Analytics</h2>
        <div style="background:var(--surface); padding:20px; border-radius:20px; border:1px solid var(--border);">
            <canvas id="chartCanvas" style="width:100% !important; height:300px !important;"></canvas>
        </div>
        <div id="stat-list" style="margin-top:20px;"></div>
    </div>

    <div id="scr-sys" class="screen">
        <h2 style="margin-bottom:20px;">System</h2>
        <div style="background:var(--surface); border-radius:15px; border:1px solid var(--border); overflow:hidden;">
            <div style="padding:18px; border-bottom:1px solid var(--border);" onclick="alert('Offline: Data stored on hardware.')">Privacy Protocol</div>
            <div style="padding:18px; color:var(--danger);" onclick="localStorage.clear(); location.reload();">Factory Reset</div>
        </div>
    </div>

    <div id="modal" class="overlay" style="display:none; background:rgba(0,0,0,0.95);">
        <div style="background:var(--surface); width:100%; padding:30px; border-radius:24px;">
            <h2 id="m-title" style="margin-bottom:20px;">Entry</h2>
            <input type="number" id="m-amt" class="search-box" placeholder="Amount" inputmode="decimal">
            <input type="text" id="m-desc" class="search-box" placeholder="Description">
            <select id="m-cat" class="search-box">
                <option value="General">General</option>
                <option value="Salary">Salary</option>
                <option value="Food">Food</option>
                <option value="Shopping">Shopping</option>
            </select>
            <button class="btn-action" onclick="saveData()">Confirm</button>
            <button onclick="hideModal()" style="background:none; border:none; color:var(--text-dim); margin-top:20px; width:100%;">Cancel</button>
        </div>
    </div>

    <nav>
        <div class="nav-btn active" onclick="switchTab('scr-home', this)"><i class="fas fa-vault"></i>Vault</div>
        <div class="nav-btn" onclick="switchTab('scr-stats', this)"><i class="fas fa-chart-pie"></i>Analytics</div>
        <div class="nav-btn" onclick="switchTab('scr-sys', this)"><i class="fas fa-gears"></i>System</div>
    </nav>

    <script>
        const CURS = [{s:'$', n:'USD'}, {s:'Rs', n:'PKR'}, {s:'€', n:'EUR'}, {s:'£', n:'GBP'}];
        let state = { db: [], cfg: { cur: '$', pin: '1234', ob: false } };
        let entryType = 'income', tempPin = '', myChart = null;

        // Start Up
        window.onload = () => {
            if(localStorage.getItem('titan_db')) state.db = JSON.parse(localStorage.getItem('titan_db'));
            if(localStorage.getItem('titan_cfg')) state.cfg = JSON.parse(localStorage.getItem('titan_cfg'));

            if(!state.cfg.ob) {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('ob-screen').style.display = 'flex';
                renderOB();
            } else {
                renderPad();
                updateHome();
            }
        };

        // UI Logic
        function switchTab(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active-screen');
            el.classList.add('active');
            if(id === 'scr-stats') renderChart();
        }

        function renderOB() {
            document.getElementById('cur-list').innerHTML = CURS.map(c => `<div class="tx-card" onclick="setCur('${c.s}')"><b>${c.n}</b> (${c.s})</div>`).join('');
        }
        function setCur(s) { state.cfg.cur = s; state.cfg.ob = true; save(); location.reload(); }

        function renderPad() {
            const keys = ['1','2','3','4','5','6','7','8','9','','0','<'];
            document.getElementById('pad').innerHTML = keys.map(k => `<div onclick="tapPin('${k}')">${k==='<'?'←':k}</div>`).join('');
        }

        function tapPin(v) {
            if(v==='') return;
            if(v==='<') tempPin = tempPin.slice(0,-1);
            else if(tempPin.length < 4) tempPin += v;
            
            const dots = document.querySelectorAll('.pin-dot');
            dots.forEach((d,i) => d.className = i < tempPin.length ? 'pin-dot filled' : 'pin-dot');
            if(tempPin.length === 4) {
                if(tempPin === state.cfg.pin) { document.getElementById('lock-screen').style.display = 'none'; tempPin = ''; }
                else { tempPin = ''; dots.forEach(d => d.className = 'pin-dot'); }
            }
        }

        function showModal(t) { entryType = t; document.getElementById('m-title').innerText = t === 'income' ? 'Revenue' : 'Expense'; document.getElementById('modal').style.display = 'flex'; }
        function hideModal() { document.getElementById('modal').style.display = 'none'; }

        function saveData() {
            const val = parseFloat(document.getElementById('m-amt').value);
            const d = document.getElementById('m-desc').value || 'Entry';
            if(!val) return;
            state.db.push({ t: entryType, a: val, d: d, c: document.getElementById('m-cat').value, date: new Date().toLocaleDateString() });
            save(); hideModal(); updateHome();
            document.getElementById('m-amt').value = ''; document.getElementById('m-desc').value = '';
        }

        function updateHome() {
            let bal = 0; const list = document.getElementById('history');
            const query = document.getElementById('search').value.toLowerCase();
            list.innerHTML = '';
            
            state.db.forEach(i => bal += (i.t === 'income' ? i.a : -i.a));
            document.getElementById('main-bal').innerText = state.cfg.cur + bal.toLocaleString();

            state.db.slice().reverse().filter(x => x.d.toLowerCase().includes(query)).forEach(i => {
                list.innerHTML += `<div class="tx-card"><div><b>${i.d}</b><br><small style="color:var(--text-dim)">${i.c}</small></div>
                <b style="color:${i.t==='income'?'var(--success)':'white'}">${i.t==='income'?'+':'-'}${state.cfg.cur}${i.a}</b></div>`;
            });
        }

        function renderChart() {
            const ctx = document.getElementById('chartCanvas');
            const dataMap = {};
            state.db.filter(x => x.t === 'expense').forEach(x => dataMap[x.c] = (dataMap[x.c] || 0) + x.a);
            
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: Object.keys(dataMap), datasets: [{ data: Object.values(dataMap), backgroundColor: ['#6366f1', '#10b981', '#f43f5e', '#fbbf24'], borderWidth: 0 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8' } } } }
            });
        }

        function save() {
            localStorage.setItem('titan_db', JSON.stringify(state.db));
            localStorage.setItem('titan_cfg', JSON.stringify(state.cfg));
        }
    </script>
</body>
</html>
