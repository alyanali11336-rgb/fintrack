<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartSpend Elite | Final Sovereign</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand: #6366f1; --bg: #0b0f1a; --surface: #161b2c; --surface-sub: #232a42;
            --text: #ffffff; --text-dim: #94a3b8; --success: #10b981; --danger: #f43f5e;
            --border: rgba(255,255,255,0.06); --radius: 22px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* Navigation */
        nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(11, 15, 26, 0.98); backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-link { color: var(--text-dim); text-align: center; font-size: 11px; font-weight: 700; cursor: pointer; }
        .nav-link.active { color: var(--brand); }
        .nav-link i { font-size: 22px; margin-bottom: 4px; display: block; }

        /* Screen Management */
        .screen { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 110px; }
        .screen.active { display: block; animation: fadeIn 0.3s ease-out; }

        /* UI Components */
        .hero { background: linear-gradient(160deg, var(--brand) 0%, #000 140%); padding: 30px 20px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .tx-card { background: var(--surface); padding: 15px; border-radius: 18px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .icon-box { width: 42px; height: 42px; border-radius: 12px; background: var(--surface-sub); display: flex; align-items: center; justify-content: center; color: var(--brand); }
        .btn-prime { background: var(--brand); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: 800; width: 100%; cursor: pointer; transition: 0.2s; }
        .btn-prime:active { transform: scale(0.97); }

        /* Search Bar */
        .search-container { position: sticky; top: 0; background: var(--bg); padding: 10px 0; z-index: 10; margin-bottom: 15px; }
        .search-bar { width: 100%; padding: 14px 45px; border-radius: 14px; border: 1px solid var(--border); background: var(--surface); color: white; font-size: 15px; }
        .search-icon { position: absolute; left: 15px; top: 23px; color: var(--text-dim); }

        /* Overlays */
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: none; flex-direction: column; padding: 30px; text-align: center; justify-content: center; }
        .pin-dot { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--brand); margin: 8px; transition: 0.2s; }
        .pin-dot.filled { background: var(--brand); transform: scale(1.2); }

        /* Modals */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9000; align-items: flex-end; }
        .modal-content { background: var(--surface); width: 100%; padding: 30px 20px; border-radius: 25px 25px 0 0; max-height: 80vh; overflow-y: auto; }
        input, select { width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px; border: 1px solid var(--border); background: var(--surface-sub); color: white; outline: none; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="duke-lock" class="overlay">
        <i class="fas fa-user-lock fa-3x" style="color:var(--brand); margin-bottom:20px;"></i>
        <h2>Prisoner Restricted</h2>
        <div style="display:flex; justify-content:center; margin: 30px 0;" id="pin-dots">
            <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
        </div>
        <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; max-width:280px; margin: 0 auto;" id="pin-pad"></div>
    </div>

    <div id="ob-screen" class="overlay">
        <h2>Vault Asset Type</h2>
        <p style="color:var(--text-dim); margin-bottom:20px;">Select your primary currency</p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:25px;" id="cur-grid"></div>
        <button class="btn-prime" onclick="confirmOnboarding()">Authorize Vault</button>
    </div>

    <div id="home" class="screen active">
        <div class="hero">
            <p style="font-size:11px; font-weight:800; opacity:0.6; letter-spacing:1px;">TOTAL LIQUIDITY</p>
            <h1 id="total-bal" style="font-size:36px; margin:5px 0;">--</h1>
            <p style="font-size:10px; opacity:0.5;"><i class="fas fa-shield-halved"></i> Duke Core Protection</p>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-bar" id="search-input" placeholder="Search transactions..." oninput="renderHome()">
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:25px;">
            <button class="btn-prime" style="background:var(--success);" onclick="openForm('income')"><i class="fas fa-plus"></i> Revenue</button>
            <button class="btn-prime" style="background:var(--danger);" onclick="openForm('expense')"><i class="fas fa-minus"></i> Expense</button>
        </div>
        <div id="tx-history"></div>
    </div>

    <div id="analytics" class="screen">
        <h2>Athletics</h2>
        <div style="background:var(--surface); padding:20px; border-radius:20px; margin: 20px 0; border: 1px solid var(--border);">
            <canvas id="apexChart" style="max-height:280px;"></canvas>
        </div>
        <div id="breakdown-list"></div>
    </div>

    <div id="system" class="screen">
        <h2>System Terminal</h2>
        <div style="margin:20px 0; background:var(--surface); border-radius:18px; border:1px solid var(--border); overflow:hidden;">
            <div style="padding:18px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between;" onclick="showPolicy()">
                <span>Privacy Protocol</span><i class="fas fa-user-shield"></i>
            </div>
            <div style="padding:18px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between;" onclick="window.location.href='mailto:fynovostudio@gmail.com'">
                <span>Support Hub</span><i class="fas fa-envelope"></i>
            </div>
            <div style="padding:18px; color:var(--danger);" onclick="factoryReset()">Factory Reset</div>
        </div>
    </div>

    <div id="form-modal" class="modal" onclick="if(event.target==this) this.style.display='none'">
        <div class="modal-content">
            <h2 id="modal-title">Entry</h2><br>
            <input type="number" id="f-amt" placeholder="0.00" inputmode="decimal">
            <input type="text" id="f-desc" placeholder="Merchant/Source">
            <select id="f-cat">
                <option value="General">General</option>
                <option value="Salary">Salary</option>
                <option value="Food">Food</option>
                <option value="Shopping">Shopping</option>
                <option value="Health">Health</option>
            </select>
            <button class="btn-prime" onclick="saveEntry()">Commit Vault Entry</button>
        </div>
    </div>

    <nav>
        <div class="nav-link active" onclick="nav('home', this)"><i class="fas fa-vault"></i>Vault</div>
        <div class="nav-link" onclick="nav('analytics', this)"><i class="fas fa-chart-pie"></i>Athletics</div>
        <div class="nav-link" onclick="nav('system', this)"><i class="fas fa-microchip"></i>System</div>
    </nav>

    <script>
        const CURS = [{n:'USD', s:'$'}, {n:'PKR', s:'Rs'}, {n:'EUR', s:'€'}, {n:'GBP', s:'£'}, {n:'INR', s:'₹'}];
        let state = { db: [], cfg: { onboard: false, cur: '$', pin: '1234' } };
        let tempPin = '', myChart = null;

        function save() {
            localStorage.setItem('sv_db_final', JSON.stringify(state.db));
            localStorage.setItem('sv_cfg_final', JSON.stringify(state.cfg));
        }

        window.onload = function() {
            const d = localStorage.getItem('sv_db_final'), c = localStorage.getItem('sv_cfg_final');
            if(d) state.db = JSON.parse(d);
            if(c) state.cfg = JSON.parse(c);

            if(!state.cfg.onboard) {
                renderOB();
            } else {
                document.getElementById('ob-screen').style.display = 'none';
                document.getElementById('duke-lock').style.display = 'flex';
                renderPad();
                renderHome();
            }
        };

        function renderOB() {
            document.getElementById('cur-grid').innerHTML = CURS.map(c => `
                <div class="cur-item" id="cur-${c.n}" style="padding:15px; background:var(--surface); border-radius:12px; border:1px solid var(--border);" onclick="selectCur('${c.s}', '${c.n}')">
                    <b>${c.n}</b> (${c.s})
                </div>`).join('');
        }

        function selectCur(s, n) {
            state.cfg.cur = s;
            document.querySelectorAll('.cur-item').forEach(i => i.style.borderColor = 'var(--border)');
            document.getElementById('cur-'+n).style.borderColor = 'var(--brand)';
        }

        function confirmOnboarding() {
            state.cfg.onboard = true; save();
            location.reload();
        }

        function renderPad() {
            const keys = ['1','2','3','4','5','6','7','8','9','','0','<'];
            document.getElementById('pin-pad').innerHTML = keys.map(k => `<div style="padding:15px; font-size:24px;" onclick="handlePin('${k}')">${k==='<'?'←':k}</div>`).join('');
        }

        function handlePin(v) {
            if(v === '') return;
            if(v === '<') tempPin = tempPin.slice(0,-1);
            else if(tempPin.length < 4) tempPin += v;
            
            const dots = document.querySelectorAll('#pin-dots .pin-dot');
            dots.forEach((d,i) => d.className = i < tempPin.length ? 'pin-dot filled' : 'pin-dot');

            if(tempPin.length === 4) {
                if(tempPin === state.cfg.pin) { document.getElementById('duke-lock').style.display = 'none'; tempPin = ''; }
                else { alert('Incorrect PIN'); tempPin = ''; dots.forEach(d => d.className = 'pin-dot'); }
            }
        }

        function nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'analytics') renderAnalytics();
        }

        function openForm(type) {
            window.currentType = type;
            document.getElementById('modal-title').innerText = type === 'income' ? 'Revenue Asset' : 'Withdrawal Asset';
            document.getElementById('form-modal').style.display = 'flex';
        }

        function saveEntry() {
            const amt = parseFloat(document.getElementById('f-amt').value);
            const desc = document.getElementById('f-desc').value || 'General Entry';
            const cat = document.getElementById('f-cat').value;
            if(!amt) return;
            state.db.push({ type: window.currentType, amt, desc, cat, date: new Date().toLocaleDateString() });
            save(); document.getElementById('form-modal').style.display = 'none';
            document.getElementById('f-amt').value = ''; document.getElementById('f-desc').value = '';
            renderHome();
        }

        function renderHome() {
            const list = document.getElementById('tx-history');
            const search = document.getElementById('search-input').value.toLowerCase();
            list.innerHTML = ''; let bal = 0;

            const filtered = state.db.filter(t => t.desc.toLowerCase().includes(search) || t.cat.toLowerCase().includes(search));
            
            state.db.forEach(t => bal += (t.type === 'income' ? t.amt : -t.amt));
            document.getElementById('total-bal').innerText = `${state.cfg.cur}${bal.toLocaleString()}`;

            filtered.slice().reverse().forEach(t => {
                const isInc = t.type === 'income';
                list.innerHTML += `
                <div class="tx-card">
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div class="icon-box"><i class="fas ${isInc ? 'fa-arrow-up' : 'fa-receipt'}"></i></div>
                        <div><b>${t.desc}</b><br><small style="color:var(--text-dim)">${t.cat}</small></div>
                    </div>
                    <b style="color:${isInc ? 'var(--success)' : 'white'}">${isInc ? '+' : '-'}${state.cfg.cur}${t.amt.toLocaleString()}</b>
                </div>`;
            });
        }

        function renderAnalytics() {
            const ctx = document.getElementById('apexChart').getContext('2d');
            const map = {};
            state.db.filter(t => t.type === 'expense').forEach(e => map[e.cat] = (map[e.cat] || 0) + e.amt);
            
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: Object.keys(map), datasets: [{ data: Object.values(map), backgroundColor: ['#6366f1', '#10b981', '#f43f5e', '#fbbf24', '#a855f7'], borderWidth: 0 }] },
                options: { cutout: '80%', plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8', padding: 20 } } } }
            });
        }

        function showPolicy() { alert("Privacy Protocol: This app is 100% Offline. Your data resides only on your local phone storage and never reaches any server."); }
        function factoryReset() { if(confirm("Permanent Vault Wipe?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
