 pinInput.slice(0, -1);
            updatePinDots();
        }

        function updatePinDots() {
            const dots = document.querySelectorAll('.pin-dot');
            dots.forEach((dot, i) => {
                if(i < pinInput.length) dot.classList.add('filled');
                else dot.classList.remove('filled');
            });
        }

        function nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function openEntry(type, id = null) {
            document.getElementById('entry-modal').style.display = 'flex';
            document.getElementById('del-btn').style.display = id ? 'block' : 'none';
            if(id) {
                const item = db.find(t => t.id === id);
                document.getElementById('edit-id').value = id;
                document.getElementById('amt').value = item.amt;
                document.getElementById('desc').value = item.desc;
                document.getElementById('cat').value = item.cat;
            } else {
                document.getElementById('edit-id').value = '';
                document.getElementById('amt').value = '';
                document.getElementById('desc').value = '';
            }
        }

        function closeEntry() { document.getElementById('entry-modal').style.display = 'none'; }

        function saveEntry() {
            const id = document.getElementById('edit-id').value;
            const amt = parseFloat(document.getElementById('amt').value);
            const desc = document.getElementById('desc').value || document.getElementById('cat').value;
            const cat = document.getElementById('cat').value;
            if(!amt) return;
            
            if(id) {
                const idx = db.findIndex(t => t.id == id);
                db[idx] = { ...db[idx], amt, desc, cat };
            } else {
                db.push({ id: Date.now(), type: (document.getElementById('modal-title').innerText.includes('Income') ? 'income' : 'expense'), amt, desc, cat, date: new Date().toLocaleDateString() });
            }
            
            localStorage.setItem('fynovo_duke_v2', JSON.stringify(db));
            closeEntry(); renderHome();
        }

        function deleteEntry() {
            db = db.filter(t => t.id != document.getElementById('edit-id').value);
            localStorage.setItem('fynovo_duke_v2', JSON.stringify(db));
            closeEntry(); renderHome();
        }

        function renderHome() {
            const list = document.getElementById('tx-list');
            list.innerHTML = ''; 
            let bal = 0;
            db.slice().reverse().forEach(t => {
                const isInc = t.type === 'income' || (t.cat === 'Salary' && t.type !== 'expense');
                bal += (isInc ? t.amt : -t.amt);
                list.innerHTML += `
                <div class="tx-card" onclick="openEntry('${t.type}', ${t.id})">
                    <div style="display:flex; align-items:center;">
                        <div class="icon-box"><i class="fas ${ICONS[t.cat] || 'fa-star'}"></i></div>
                        <div><b>${t.desc}</b><br><small style="color:var(--text-dim)">${t.date}</small></div>
                    </div>
                    <b style="color:${isInc ? 'var(--success)' : 'white'}">${config.cur}${t.amt.toLocaleString()}</b>
                </div>`;
            });
            document.getElementById('total-bal').innerText = `${config.cur} ${bal.toLocaleString()}`;
        }

        init();
    </script>
</body>
</html>